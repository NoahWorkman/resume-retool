<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Retool - 100% Factual Keyword Optimization</title>
    
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .header p {
            opacity: 0.95;
            font-size: 1.2em;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        .section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #e9ecef;
        }
        
        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #495057;
            font-weight: 600;
            font-size: 0.95em;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
            background: white;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-group textarea {
            min-height: 150px;
            resize: vertical;
            font-family: inherit;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin: 10px 10px 10px 0;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        
        .output-section {
            grid-column: span 2;
            background: white;
            border: 2px solid #dee2e6;
        }
        
        .preview {
            padding: 30px;
            min-height: 400px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.95em;
        }
        
        .skills-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .skill-tag {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }
        
        .warning-box {
            background: linear-gradient(to right, #fff3cd, #fff8dc);
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .warning-box h3 {
            color: #856404;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .warning-box ul {
            margin-left: 25px;
            color: #856404;
            line-height: 1.8;
        }
        
        .success-box {
            background: linear-gradient(to right, #d4edda, #e7f5ea);
            border: 2px solid #28a745;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .success-box h3 {
            color: #155724;
            margin-bottom: 10px;
        }
        
        .error-box {
            background: linear-gradient(to right, #f8d7da, #fde2e4);
            border: 2px solid #dc3545;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .error-box h3 {
            color: #721c24;
            margin-bottom: 10px;
        }
        
        .ai-prompt-display {
            background: #2d3436;
            color: #74b9ff;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        .ai-prompt-display strong {
            color: #a29bfe;
        }
        
        .status-message {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .status-success {
            background: linear-gradient(to right, #d4edda, #e7f5ea);
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: linear-gradient(to right, #f8d7da, #fde2e4);
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-info {
            background: linear-gradient(to right, #d1ecf1, #e7f3f5);
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #dee2e6;
        }
        
        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: #667eea;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            background: #e9ecef;
            border-color: #764ba2;
        }
        
        .upload-area.dragover {
            background: #e7e9fc;
            border-color: #764ba2;
        }
        
        .keyword-match-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .match-section {
            padding: 15px;
            border-radius: 8px;
        }
        
        .matched {
            background: linear-gradient(to right, #d4edda, #e7f5ea);
            border: 1px solid #28a745;
        }
        
        .unmatched {
            background: linear-gradient(to right, #f8d7da, #fde2e4);
            border: 1px solid #dc3545;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .output-section {
                grid-column: span 1;
            }
            
            .keyword-match-display {
                grid-template-columns: 1fr;
            }
        }
        
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Resume Retool</h1>
            <p>AI-Powered Resume Customization with 100% Factual Accuracy</p>
        </div>
        
        <div class="main-content">
            <!-- Input Section -->
            <div class="section">
                <h2>üìã Job Posting Input</h2>
                
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('paste')">üìù Paste Text</button>
                    <button class="tab" onclick="switchTab('url')">üåê URL</button>
                    <button class="tab" onclick="switchTab('upload')">üì∏ Screenshot</button>
                </div>
                
                <div id="paste-tab" class="tab-content active">
                    <div class="form-group">
                        <label>Job Description</label>
                        <textarea id="jobDescription" placeholder="Paste the complete job description here...">Vice President, DUALS Strategic Initiatives

Position Purpose: A pivotal enterprise leadership role responsible for overseeing comprehensive business strategies into actionable, scalable implementation plans across markets and business functions...

Required:
‚Ä¢ Bachelor's Degree in Business Administration, Health Care Administration, Finance, or related field
‚Ä¢ 8+ years experience in strategy, operations management, or consulting experience in Healthcare
‚Ä¢ Direct people leadership, including the management of other people leaders
‚Ä¢ 3+ years of supervisory/management experience required
‚Ä¢ DUALS experience strongly preferred</textarea>
                    </div>
                </div>
                
                <div id="url-tab" class="tab-content">
                    <div class="form-group">
                        <label>Job Posting URL</label>
                        <input type="url" id="jobUrl" placeholder="https://www.linkedin.com/jobs/view/...">
                    </div>
                    <button class="btn" onclick="fetchFromUrl()">üîç Fetch Job Posting</button>
                </div>
                
                <div id="upload-tab" class="tab-content">
                    <div class="upload-area" onclick="document.getElementById('fileInput').click()" 
                         ondrop="handleDrop(event)" 
                         ondragover="handleDragOver(event)" 
                         ondragleave="handleDragLeave(event)">
                        <input type="file" id="fileInput" accept="image/*,.pdf" style="display: none" onchange="handleFileSelect(event)">
                        <h3>üì∏ Drop Screenshot or PDF Here</h3>
                        <p>or click to browse</p>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Company Name</label>
                    <input type="text" id="company" value="Centene Corporation">
                </div>
                
                <div class="form-group">
                    <label>Position Title</label>
                    <input type="text" id="position" value="Vice President, DUALS Strategic Initiatives">
                </div>
            </div>
            
            <!-- Resume Data Section -->
            <div class="section">
                <h2>üë§ Your Resume Data</h2>
                
                <div class="form-group">
                    <label>Number of Experiences to Include</label>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <input type="range" id="experienceCount" min="2" max="6" value="5" 
                               style="flex: 1; height: 6px; background: linear-gradient(to right, #667eea 0%, #764ba2 100%); border-radius: 5px; outline: none;"
                               oninput="updateExperienceCount()">
                        <span id="experienceCountDisplay" style="font-weight: bold; color: #667eea; font-size: 1.2em; min-width: 20px;">5</span>
                        <span style="color: #6c757d; font-size: 0.9em;">positions</span>
                    </div>
                    <div style="margin-top: 8px; font-size: 0.85em; color: #6c757d;">
                        <span style="color: #28a745;">Recommended: 4-5 positions</span> for optimal ATS performance
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Experience Selection</label>
                    <div id="experiencePreview" style="background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;">
                        <div style="font-size: 0.9em; color: #495057;">
                            <strong>Current selection will include:</strong>
                            <ul style="margin-top: 10px; margin-left: 20px; line-height: 1.8;">
                                <li>TBWA WH (2023-Present) - Current Role ‚úì</li>
                                <li>Accenture (2020-2023) - Healthcare Experience</li>
                                <li>Freelance (2017-2019) - Consulting Experience</li>
                                <li>Y&R (2016-2017) - VP Leadership Role</li>
                                <li>Publicis (2010-2013) - Digital Production</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Core Skills</label>
                    <div class="skills-container">
                        <span class="skill-tag">Project Management</span>
                        <span class="skill-tag">Change Management</span>
                        <span class="skill-tag">Strategic Planning</span>
                        <span class="skill-tag">Operations Excellence</span>
                        <span class="skill-tag">Team Leadership</span>
                        <span class="skill-tag">P&L Management</span>
                        <span class="skill-tag">Digital Transformation</span>
                        <span class="skill-tag">Stakeholder Management</span>
                        <span class="skill-tag">Agile & Waterfall</span>
                        <span class="skill-tag">Risk Mitigation</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Years of Experience</label>
                    <input type="text" value="20+ years" readonly style="background: #f8f9fa;">
                </div>
                
                <div class="form-group">
                    <label>Current Role</label>
                    <input type="text" value="SVP, Director Integrated Delivery at TBWA" readonly style="background: #f8f9fa;">
                </div>
                
                <div class="form-group">
                    <label>Portfolio Size</label>
                    <input type="text" value="$70 Million" readonly style="background: #f8f9fa;">
                </div>
            </div>
            
            <!-- AI Engine Section -->
            <div class="section output-section">
                <h2>‚öôÔ∏è Keyword Optimization Engine</h2>
                
                <div class="warning-box">
                    <h3>‚ö†Ô∏è 100% Factual Guarantee</h3>
                    <ul>
                        <li>‚úÖ Rewrites existing experience to include job keywords</li>
                        <li>‚úÖ Highlights transferable skills you possess</li>
                        <li>‚úÖ Optimizes for ATS keyword matching</li>
                        <li>‚ùå NEVER adds skills or experience you don't have</li>
                        <li>‚ùå NEVER fabricates certifications or qualifications</li>
                    </ul>
                </div>
                
                <div class="ai-prompt-display">
                    <strong>// AI Instructions</strong><br>
                    CRITICAL: Maintain 100% factual accuracy<br>
                    1. Extract keywords from job posting<br>
                    2. Match ONLY to existing experience<br>
                    3. Reword bullets to include matched keywords<br>
                    4. Flag unmatched requirements honestly<br>
                    5. Never fabricate or exaggerate
                </div>
                
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn" onclick="analyzeKeywords()">
                        üîç Analyze Keywords
                    </button>
                    <button class="btn btn-success" onclick="generateCustomizedResume()">
                        üöÄ Generate Resume
                    </button>
                    <button class="btn btn-secondary" onclick="showPDFOptions()">
                        üìÑ Export PDF
                    </button>
                </div>
                
                <!-- PDF Export Options (hidden by default) -->
                <div id="pdfOptions" style="display: none; margin-top: 20px; padding: 20px; background: #f0f0f0; border-radius: 8px;">
                    <h3 style="margin-bottom: 15px;">üìÑ PDF Export Settings</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="font-weight: bold;">Font Style:</label>
                            <select id="pdfFont" style="width: 100%; padding: 8px; margin-top: 5px;">
                                <option value="helvetica" selected>Helvetica (Modern)</option>
                                <option value="times">Times New Roman (Classic)</option>
                                <option value="courier">Courier (Technical)</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-weight: bold;">Color Scheme:</label>
                            <select id="pdfColor" style="width: 100%; padding: 8px; margin-top: 5px;">
                                <option value="professional" selected>Professional Blue</option>
                                <option value="classic">Classic Black</option>
                                <option value="modern">Modern Gray</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="generatePDF()" style="margin-top: 15px;">
                        üì• Download PDF
                    </button>
                </div>
                
                <div id="statusMessage" class="status-message"></div>
                
                <div id="keywordAnalysis" style="display: none;">
                    <h3 style="margin-top: 30px;">üìä Keyword Analysis Results</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="matchProgress">0%</div>
                    </div>
                    <div class="keyword-match-display">
                        <div class="match-section matched">
                            <h4>‚úÖ Matched Keywords</h4>
                            <ul id="matchedKeywords"></ul>
                        </div>
                        <div class="match-section unmatched">
                            <h4>‚ö†Ô∏è Cannot Add (No Experience)</h4>
                            <ul id="unmatchedKeywords"></ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Resume Preview Section -->
            <div class="section output-section">
                <h2>üìù Customized Resume Preview</h2>
                <div id="resumePreview" class="preview">
                    <em style="color: #6c757d;">Your keyword-optimized resume will appear here...</em>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Sample experience data (replace with your own)
        const userData = {
            fullName: "Your Name",
            contact: "your.email@example.com | Your Location | LinkedIn",
            title: "Your Professional Title | Your Specialty",
            yearsExp: 20,
            currentCompany: "TBWA WH",
            portfolioSize: 70000000,
            teamSize: 30,
            
            experience: [
                {
                    company: "TBWA WH, NEW YORK, NY",
                    dates: "2023 ‚Äì Present",
                    title: "SVP, Director of Integrated Delivery/Project + Program Management",
                    bullets: [
                        "Lead strategic initiatives across $70M portfolio with enterprise-wide impact",
                        "Drive operational transformation and change management for 30+ team members",
                        "Partner with executive stakeholders to align strategic priorities",
                        "Design scalable implementation frameworks for cross-functional execution",
                        "Champion best practices and continuous improvement initiatives",
                        "Operationalize AI practices within PM department and overall agency"
                    ]
                },
                {
                    company: "ACCENTURE, NEW YORK, NY",
                    dates: "2020 ‚Äì 2023",
                    title: "Marketing and Communications Brand Delivery Lead",
                    bullets: [
                        "Managed strategic initiatives for healthcare and financial services clients",
                        "Led cross-functional transformation programs across multiple markets",
                        "Developed scalable operational frameworks and governance structures",
                        "Mentored team of 8-12 project managers while managing P&L",
                        "Promoted from NY to NA and Canada Brand Delivery Lead"
                    ]
                },
                {
                    company: "FREELANCE",
                    dates: "2017 ‚Äì 2019",
                    title: "Executive Producer/PMO Consultant",
                    bullets: [
                        "Led project portfolio management and implemented PM tools and methods",
                        "Managed complex projects from initiation through deployment",
                        "Won Global VW Pitch as Executive Producer/Lead PMO for WPP",
                        "Clients: Walmart, Pepperidge Farm, Merck, Cigna, Honeywell"
                    ]
                },
                {
                    company: "Y&R NY",
                    dates: "2016 ‚Äì 2017",
                    title: "VP, Director of Project Management and Digital Operations",
                    bullets: [
                        "Built and led PM Department of 10 Project Managers",
                        "Managed entire P&L across projects and resource allocations",
                        "Improved and digitized production work streams across agency",
                        "Tracked program performance through KPIs and budget management"
                    ]
                },
                {
                    company: "FREELANCE",
                    dates: "2013 ‚Äì 2016",
                    title: "Executive Producer",
                    bullets: [
                        "Produced digital content for major agency clients",
                        "Clients: Ogilvy, Atmosphere BBDO, Havas Group, RAPP, Geometry/G2",
                        "Managed campaigns for IBM, UPS, Siemens, J&J, Pfizer"
                    ]
                },
                {
                    company: "PUBLICIS KAPLAN THALER",
                    dates: "2010 ‚Äì 2013",
                    title: "Head of Digital Production",
                    bullets: [
                        "Oversaw $15-20M business and delivery processes",
                        "Managed 30+ projects across 14 accounts including Wendy's, Merck, P&G",
                        "Established first Digital PM/Production Department",
                        "Won 2 Webbys, 4 IACs, and 1 Golden Tweet Award"
                    ]
                }
            ],
            
            verifiedSkills: [
                "Project & Program Management",
                "Change Management",
                "Digital Production",
                "Agile & Waterfall Methodology",
                "Risk Assessment & Mitigation",
                "Stakeholder Management",
                "Operations Management",
                "Vendor Management",
                "Financial & Budget Planning",
                "Workflow Design",
                "Team Leadership",
                "P&L Management",
                "Strategic Planning",
                "Digital Transformation"
            ],
            
            verifiedDomains: {
                leadership: ["SVP", "Director", "30+ team members", "executive leadership"],
                operations: ["operations management", "operational excellence", "workflow optimization"],
                financial: ["$70M portfolio", "P&L responsibility", "budget planning"],
                industries: ["advertising", "marketing", "healthcare clients", "financial services clients"],
                transformation: ["change management", "digital transformation", "modernization"]
            },
            
            forbiddenKeywords: [
                "clinical", "patient care", "HIPAA", "medical", "nursing",
                "coding", "programming", "software development",
                "CPA", "PMP", "Six Sigma", "ITIL"
            ]
        };
        
        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }
        
        // File handling
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                showStatus(`üìÅ File selected: ${file.name}`, 'info');
                // In real implementation, would process with OCR/PDF extraction
            }
        }
        
        function handleDrop(event) {
            event.preventDefault();
            event.target.classList.remove('dragover');
            const file = event.dataTransfer.files[0];
            if (file) {
                showStatus(`üìÅ File dropped: ${file.name}`, 'info');
            }
        }
        
        function handleDragOver(event) {
            event.preventDefault();
            event.target.classList.add('dragover');
        }
        
        function handleDragLeave(event) {
            event.target.classList.remove('dragover');
        }
        
        // Keyword Analysis
        function analyzeKeywords() {
            showStatus('üîç Analyzing job keywords...', 'info');
            
            const jobText = document.getElementById('jobDescription').value.toLowerCase();
            const matched = [];
            const unmatched = [];
            
            // Simulate keyword extraction
            const jobKeywords = extractKeywords(jobText);
            
            jobKeywords.forEach(keyword => {
                if (canClaimKeyword(keyword)) {
                    matched.push({
                        keyword: keyword,
                        mapping: getKeywordMapping(keyword)
                    });
                } else {
                    unmatched.push({
                        keyword: keyword,
                        reason: "No direct experience"
                    });
                }
            });
            
            // Display results
            displayKeywordAnalysis(matched, unmatched);
            
            // Update experience preview based on analysis
            updateExperiencePreview(jobText, parseInt(document.getElementById('experienceCount').value));
            
            showStatus('‚úÖ Keyword analysis complete!', 'success');
        }
        
        function extractKeywords(text) {
            // Simplified keyword extraction
            const keywords = [];
            
            const patterns = [
                "strategic", "healthcare", "operations", "leadership",
                "change management", "cross-functional", "stakeholder",
                "implementation", "transformation", "medicaid", "medicare"
            ];
            
            patterns.forEach(pattern => {
                if (text.includes(pattern)) {
                    keywords.push(pattern);
                }
            });
            
            return keywords;
        }
        
        function canClaimKeyword(keyword) {
            // Check if keyword matches user's experience
            if (userData.forbiddenKeywords.some(forbidden => keyword.includes(forbidden))) {
                return false;
            }

            // Check if keyword relates to verified experience
            const allVerified = [
                ...userData.verifiedSkills,
                ...Object.values(userData.verifiedDomains).flat()
            ].map(s => s.toLowerCase());
            
            return allVerified.some(verified => 
                verified.includes(keyword) || keyword.includes(verified.split(' ')[0])
            );
        }
        
        function getKeywordMapping(keyword) {
            const mappings = {
                "strategic": "Strategic planning and initiatives at TBWA",
                "healthcare": "Healthcare sector clients at Accenture",
                "operations": "Operations management and excellence",
                "leadership": "Leading 30+ person team",
                "change management": "Direct experience in change management",
                "transformation": "Digital transformation initiatives"
            };
            
            return mappings[keyword] || "Relevant experience";
        }
        
        function displayKeywordAnalysis(matched, unmatched) {
            const matchRate = (matched.length / (matched.length + unmatched.length)) * 100;
            
            document.getElementById('keywordAnalysis').style.display = 'block';
            document.getElementById('matchProgress').style.width = matchRate + '%';
            document.getElementById('matchProgress').textContent = Math.round(matchRate) + '%';
            
            const matchedList = document.getElementById('matchedKeywords');
            matchedList.innerHTML = matched.map(m => 
                `<li><strong>${m.keyword}</strong> ‚Üí ${m.mapping}</li>`
            ).join('');
            
            const unmatchedList = document.getElementById('unmatchedKeywords');
            unmatchedList.innerHTML = unmatched.map(u => 
                `<li><strong>${u.keyword}</strong>: ${u.reason}</li>`
            ).join('');
        }
        
        // Resume Generation
        function generateCustomizedResume() {
            showStatus('üöÄ Generating customized resume...', 'info');
            
            const company = document.getElementById('company').value;
            const position = document.getElementById('position').value;
            const jobDescription = document.getElementById('jobDescription').value;
            
            // Build customized resume
            let resume = `${userData.fullName}\n${userData.contact}\n\n`;
            resume += `${position} Candidate | ${userData.title}\n\n`;

            resume += `PROFESSIONAL SUMMARY\n`;
            resume += `Highly accomplished executive with ${userData.yearsExp}+ years driving strategic initiatives and operational excellence. `;
            resume += `Proven track record leading enterprise-wide transformations, managing cross-functional teams, and delivering measurable outcomes. `;
            resume += `Expert in change management, strategic planning, and scalable solution deployment.\n\n`;
            
            resume += `CORE COMPETENCIES\n`;
            const prioritizedSkills = prioritizeSkills(jobDescription);
            prioritizedSkills.forEach(skill => {
                resume += `‚Ä¢ ${skill}\n`;
            });
            
            resume += `\nPROFESSIONAL EXPERIENCE\n\n`;
            
            // Include relevant experiences based on job
            const experiences = selectRelevantExperiences(jobDescription);
            
            experiences.forEach(exp => {
                resume += `${exp.company}                                                ${exp.dates}\n`;
                resume += `${exp.title}\n`;
                exp.bullets.forEach(bullet => {
                    resume += `‚Ä¢ ${bullet}\n`;
                });
                resume += `\n`;
            });
            
            resume += `EDUCATION\n`;
            resume += `MFA, Literature, Fiction, Writing | City University of New York-Brooklyn College\n`;
            resume += `B.A. Degree, Literature and Creative Writing | Binghamton University`;
            
            document.getElementById('resumePreview').textContent = resume;
            showStatus('‚úÖ Resume generated successfully!', 'success');
        }
        
        function updateExperienceCount() {
            const count = document.getElementById('experienceCount').value;
            document.getElementById('experienceCountDisplay').textContent = count;
            
            // Update preview to show which experiences will be included
            const jobText = document.getElementById('jobDescription').value;
            updateExperiencePreview(jobText, parseInt(count));
        }
        
        function updateExperiencePreview(jobText, maxCount) {
            const selected = selectRelevantExperiences(jobText, maxCount);
            const previewEl = document.getElementById('experiencePreview');
            
            let html = '<div style="font-size: 0.9em; color: #495057;">';
            html += '<strong>Selected experiences based on job keywords:</strong>';
            html += '<ul style="margin-top: 10px; margin-left: 20px; line-height: 1.8;">';
            
            selected.forEach((exp, index) => {
                let reason = '';
                if (index === 0) reason = ' - Current Role ‚úì';
                else if (exp.company.includes('ACCENTURE')) reason = ' - Healthcare/Enterprise';
                else if (exp.company.includes('Y&R')) reason = ' - VP Leadership';
                else if (exp.dates.includes('2017')) reason = ' - Consulting';
                else if (exp.company.includes('PUBLICIS')) reason = ' - Digital Production';
                else reason = ' - Additional Experience';
                
                const style = index < maxCount ? 'color: #28a745; font-weight: 500;' : 'color: #ccc; text-decoration: line-through;';
                html += `<li style="${style}">${exp.company.split(',')[0]} (${exp.dates})${reason}</li>`;
            });
            
            html += '</ul>';
            
            if (maxCount < 4) {
                html += '<div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 5px; color: #856404;">';
                html += '‚ö†Ô∏è Including fewer than 4 positions may not fully showcase your experience';
                html += '</div>';
            }
            
            html += '</div>';
            previewEl.innerHTML = html;
        }
        
        function selectRelevantExperiences(jobText, maxCount) {
            const jobLower = jobText.toLowerCase();
            const selected = [];
            const experienceCount = maxCount || parseInt(document.getElementById('experienceCount').value) || 5;

            // Score each experience based on relevance
            const scoredExperiences = userData.experience.map(exp => {
                let score = 0;
                
                // Current role gets highest priority
                if (exp.dates.includes('Present')) score += 100;
                
                // Score based on job keywords
                if (jobLower.includes('healthcare') || jobLower.includes('health')) {
                    if (exp.company.includes('ACCENTURE')) score += 50;
                }
                
                if (jobLower.includes('vice president') || jobLower.includes('vp') || 
                    jobLower.includes('executive') || jobLower.includes('director')) {
                    if (exp.title.includes('VP') || exp.title.includes('Director')) score += 40;
                }
                
                if (jobLower.includes('consulting') || jobLower.includes('consultant')) {
                    if (exp.title.includes('Consultant')) score += 40;
                }
                
                if (jobLower.includes('digital') || jobLower.includes('production')) {
                    if (exp.title.includes('Digital') || exp.title.includes('Production')) score += 30;
                }
                
                if (jobLower.includes('strategic') || jobLower.includes('strategy')) {
                    if (exp.bullets.some(b => b.toLowerCase().includes('strategic'))) score += 20;
                }
                
                if (jobLower.includes('transformation') || jobLower.includes('change')) {
                    if (exp.bullets.some(b => b.toLowerCase().includes('transform') || 
                                           b.toLowerCase().includes('change'))) score += 20;
                }
                
                // Recency bonus (more recent = higher score)
                const year = parseInt(exp.dates.match(/\d{4}/)?.[0] || 0);
                score += (year - 2000) / 2;
                
                return { ...exp, score };
            });
            
            // Sort by score and select top N
            scoredExperiences.sort((a, b) => b.score - a.score);
            const topExperiences = scoredExperiences.slice(0, experienceCount);
            
            // Sort selected experiences chronologically (most recent first)
            topExperiences.sort((a, b) => {
                const aYear = parseInt(a.dates.match(/\d{4}/)?.[0] || 0);
                const bYear = parseInt(b.dates.match(/\d{4}/)?.[0] || 0);
                return bYear - aYear;
            });
            
            // Limit bullets for space (3-4 per role depending on total count)
            const bulletsPerRole = experienceCount <= 3 ? 5 : experienceCount <= 4 ? 4 : 3;
            
            return topExperiences.map(exp => ({
                ...exp,
                bullets: exp.bullets.slice(0, bulletsPerRole)
            }));
        }
        
        function prioritizeSkills(jobText) {
            const jobLower = jobText.toLowerCase();
            const skills = [...userData.verifiedSkills];
            
            // Prioritize skills mentioned in job
            skills.sort((a, b) => {
                const aInJob = jobLower.includes(a.toLowerCase()) ? -1 : 1;
                const bInJob = jobLower.includes(b.toLowerCase()) ? -1 : 1;
                return aInJob - bInJob;
            });
            
            return skills.slice(0, 12);
        }
        
        // PDF Export functions
        function showPDFOptions() {
            const pdfOptions = document.getElementById('pdfOptions');
            const resumeText = document.getElementById('resumePreview').textContent;
            
            if (!resumeText || resumeText.includes('Your keyword-optimized resume will appear here')) {
                showStatus('‚ö†Ô∏è Please generate a resume first', 'error');
                return;
            }
            
            pdfOptions.style.display = pdfOptions.style.display === 'none' ? 'block' : 'none';
        }
        
        function generatePDF() {
            const resumeText = document.getElementById('resumePreview').textContent;
            
            if (!resumeText || resumeText.includes('Your keyword-optimized resume will appear here')) {
                showStatus('‚ö†Ô∏è Please generate a resume first', 'error');
                return;
            }
            
            showStatus('üìÑ Generating professional PDF...', 'info');
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'pt',
                format: 'letter'
            });
            
            const fontStyle = document.getElementById('pdfFont').value;
            const colorScheme = document.getElementById('pdfColor').value;
            
            // Set colors based on scheme
            let headerColor = [44, 62, 80]; // Professional blue
            let accentColor = [52, 152, 219];
            let textColor = [50, 50, 50];
            
            if (colorScheme === 'classic') {
                headerColor = [0, 0, 0];
                accentColor = [0, 0, 0];
                textColor = [0, 0, 0];
            } else if (colorScheme === 'modern') {
                headerColor = [52, 73, 94];
                accentColor = [127, 140, 141];
                textColor = [60, 60, 60];
            }
            
            // Set margins - FIXED for proper text wrapping
            const leftMargin = 50;
            const rightMargin = 50;
            const topMargin = 50;
            const bottomMargin = 50;
            const pageWidth = doc.internal.pageSize.width;
            const pageHeight = doc.internal.pageSize.height;
            const contentWidth = pageWidth - leftMargin - rightMargin;
            
            let y = topMargin;
            
            // Set font
            doc.setFont(fontStyle);
            
            // Parse resume text
            const lines = resumeText.split('\n').map(line => line.trim()).filter(line => line);
            
            // Helper function to check if new page needed
            const checkNewPage = (neededSpace = 20) => {
                if (y + neededSpace > pageHeight - bottomMargin) {
                    doc.addPage();
                    y = topMargin;
                    return true;
                }
                return false;
            };
            
            // Helper to wrap and add text properly
            const addWrappedText = (text, fontSize, indent = 0, lineHeight = fontSize * 1.2) => {
                doc.setFontSize(fontSize);
                const wrappedLines = doc.splitTextToSize(text, contentWidth - indent);
                
                wrappedLines.forEach((line, index) => {
                    checkNewPage(lineHeight);
                    doc.text(line, leftMargin + indent, y);
                    y += lineHeight;
                });
            };
            
            // Process each line
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                
                // Name (first line)
                if (i === 0) {
                    checkNewPage(30);
                    doc.setTextColor(headerColor[0], headerColor[1], headerColor[2]);
                    doc.setFontSize(24);
                    doc.setFont(fontStyle, 'bold');
                    const textWidth = doc.getTextWidth(line);
                    const x = (pageWidth - textWidth) / 2;
                    doc.text(line, x, y);
                    y += 26;
                }
                // Contact info
                else if (i === 1 && (line.includes('|') || line.includes('@'))) {
                    doc.setTextColor(100, 100, 100);
                    doc.setFontSize(10);
                    doc.setFont(fontStyle, 'normal');
                    const formatted = line.replace(/\|/g, ' ‚Ä¢ ');
                    const textWidth = doc.getTextWidth(formatted);
                    const x = (pageWidth - textWidth) / 2;
                    doc.text(formatted, x, y);
                    y += 16;
                }
                // Professional title
                else if (line.includes('Candidate') && i < 5) {
                    checkNewPage(30);
                    doc.setTextColor(headerColor[0], headerColor[1], headerColor[2]);
                    doc.setFont(fontStyle, 'bold');
                    
                    // Wrap long title if needed
                    const wrappedTitle = doc.splitTextToSize(line, contentWidth);
                    doc.setFontSize(11);
                    
                    wrappedTitle.forEach(titleLine => {
                        const textWidth = doc.getTextWidth(titleLine);
                        const x = (pageWidth - textWidth) / 2;
                        doc.text(titleLine, x, y);
                        y += 14;
                    });
                    
                    y += 8;
                    
                    // Add accent line
                    doc.setDrawColor(accentColor[0], accentColor[1], accentColor[2]);
                    doc.setLineWidth(0.5);
                    doc.line(leftMargin, y, pageWidth - rightMargin, y);
                    y += 10;
                }
                // Section headers
                else if (['PROFESSIONAL SUMMARY', 'CORE COMPETENCIES', 'PROFESSIONAL EXPERIENCE', 'EDUCATION'].includes(line)) {
                    checkNewPage(25);
                    y += 8;
                    doc.setTextColor(headerColor[0], headerColor[1], headerColor[2]);
                    doc.setFontSize(12);
                    doc.setFont(fontStyle, 'bold');
                    doc.text(line, leftMargin, y);
                    y += 3;
                    
                    // Add underline
                    doc.setDrawColor(accentColor[0], accentColor[1], accentColor[2]);
                    doc.setLineWidth(0.5);
                    const lineWidth = doc.getTextWidth(line);
                    doc.line(leftMargin, y, leftMargin + lineWidth, y);
                    y += 10;
                }
                // Bullet points
                else if (line.startsWith('‚Ä¢')) {
                    doc.setTextColor(textColor[0], textColor[1], textColor[2]);
                    doc.setFont(fontStyle, 'normal');
                    
                    // Split into bullet and text
                    const bulletText = line.substring(1).trim();
                    const bulletIndent = 15;
                    
                    // Wrap text properly
                    doc.setFontSize(10);
                    const wrappedLines = doc.splitTextToSize(bulletText, contentWidth - bulletIndent - 10);
                    
                    wrappedLines.forEach((textLine, index) => {
                        checkNewPage(12);
                        if (index === 0) {
                            // First line with bullet
                            doc.text('‚Ä¢', leftMargin + 5, y);
                            doc.text(textLine, leftMargin + bulletIndent, y);
                        } else {
                            // Continuation lines indented
                            doc.text(textLine, leftMargin + bulletIndent, y);
                        }
                        y += 12;
                    });
                }
                // Company/dates line
                else if (line.match(/\d{4}\s*‚Äì\s*(Present|\d{4})/)) {
                    checkNewPage(20);
                    y += 6;
                    
                    // Extract company and dates
                    const dateMatch = line.match(/(\d{4}\s*‚Äì\s*(Present|\d{4}))/);
                    if (dateMatch) {
                        const dateStr = dateMatch[0];
                        let company = line.replace(dateStr, '').trim();
                        
                        // Remove extra spaces
                        company = company.replace(/\s+/g, ' ').trim();
                        
                        // Company name (left aligned)
                        doc.setTextColor(headerColor[0], headerColor[1], headerColor[2]);
                        doc.setFontSize(11);
                        doc.setFont(fontStyle, 'bold');
                        
                        // Check if company name needs wrapping
                        const maxCompanyWidth = contentWidth - 80; // Leave space for dates
                        const companyLines = doc.splitTextToSize(company, maxCompanyWidth);
                        
                        if (companyLines.length === 1) {
                            // Single line - company left, dates right
                            doc.text(company, leftMargin, y);
                            
                            // Dates (right aligned)
                            doc.setTextColor(127, 140, 141);
                            doc.setFontSize(10);
                            doc.setFont(fontStyle, 'normal');
                            const dateWidth = doc.getTextWidth(dateStr);
                            doc.text(dateStr, pageWidth - rightMargin - dateWidth, y);
                        } else {
                            // Multi-line company name
                            companyLines.forEach((compLine, idx) => {
                                doc.text(compLine, leftMargin, y);
                                if (idx === 0) {
                                    // Put dates on first line
                                    doc.setTextColor(127, 140, 141);
                                    doc.setFontSize(10);
                                    doc.setFont(fontStyle, 'normal');
                                    const dateWidth = doc.getTextWidth(dateStr);
                                    doc.text(dateStr, pageWidth - rightMargin - dateWidth, y);
                                    doc.setTextColor(headerColor[0], headerColor[1], headerColor[2]);
                                    doc.setFont(fontStyle, 'bold');
                                }
                                y += 12;
                            });
                            y -= 12; // Adjust for the loop increment
                        }
                    } else {
                        // Fallback if no date match
                        doc.setTextColor(headerColor[0], headerColor[1], headerColor[2]);
                        doc.setFontSize(11);
                        doc.setFont(fontStyle, 'bold');
                        addWrappedText(line, 11, 0, 14);
                        y -= 14; // Adjust since addWrappedText increments y
                    }
                    y += 14;
                }
                // Job titles
                else if (line.includes('SVP') || line.includes('Director') || line.includes('Lead') || 
                         line.includes('Manager') || line.includes('VP') || line.includes('President') ||
                         line.includes('Executive') || line.includes('Head of')) {
                    doc.setTextColor(80, 80, 80);
                    doc.setFontSize(10);
                    doc.setFont(fontStyle, 'italic');
                    
                    // Wrap job title if needed
                    const wrappedTitle = doc.splitTextToSize(line, contentWidth);
                    wrappedTitle.forEach(titleLine => {
                        checkNewPage(12);
                        doc.text(titleLine, leftMargin, y);
                        y += 12;
                    });
                    y += 4;
                }
                // Regular text (summary, education, etc.)
                else {
                    doc.setTextColor(textColor[0], textColor[1], textColor[2]);
                    doc.setFontSize(10);
                    doc.setFont(fontStyle, 'normal');
                    
                    // Properly wrap all text
                    const wrappedLines = doc.splitTextToSize(line, contentWidth);
                    
                    wrappedLines.forEach(textLine => {
                        checkNewPage(12);
                        doc.text(textLine, leftMargin, y);
                        y += 12;
                    });
                }
            }
            
            // Save the PDF
            const company = document.getElementById('company').value || 'Resume';
            const date = new Date().toISOString().split('T')[0];
            const fileName = `${company.replace(/\s+/g, '_')}_Resume_${date}.pdf`;
            
            doc.save(fileName);
            showStatus(`‚úÖ PDF saved as: ${fileName}`, 'success');
            
            // Hide PDF options after generation
            document.getElementById('pdfOptions').style.display = 'none';
        }
        
        // Status messages
        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message status-${type}`;
            statusEl.style.display = 'block';
            
            if (type !== 'error') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 5000);
            }
        }
        
        // URL fetching
        function fetchFromUrl() {
            const url = document.getElementById('jobUrl').value;
            if (url) {
                showStatus('üåê Fetching job posting from URL...', 'info');
                // In real implementation, would fetch and parse URL
                setTimeout(() => {
                    showStatus('‚úÖ Job posting fetched! (Demo mode - paste text instead)', 'success');
                }, 1500);
            }
        }
        
        // Initialize
        window.onload = function() {
            console.log('Resume Retool loaded successfully');
        };
    </script>
</body>
</html>